# Code

This folder contains the reproducability steps for running the fpgaconvnet-generated accelerators. 
Steps 1., 2. and 3. can be ignored if you are using the provided `boot/BOOT.bin`.

## 1. Download the Model

The model used is the pretrained INT8 quantised model from the [MLCommons Tiny](https://github.com/mlcommons/tiny) repo.
To download the model, use the provided `download_quant_model.sh` script.

## 2. Config Configuration

The backend tool uses the configuration file generated to create the bitstream.
To produce the configuration file used, run `python create_config.py`.
This requires the python setup described in the root README.md.

This creates the JSON configuration file, which contains a configuration for the downloaded model and platform.
The configuration file is used to generate HDL, and subsequently an IP which contains the hardware for the whole network.
The hardware for this benchmark is generated by a closed-source backend, however there is the open-source [fpgaconvnet-hls](https://github.com/AlexMontgomerie/fpgaconvnet-hls) that supports the same JSON format, and we are working on supporting these models with the open-source backend also.

Please feel free to reach out if you are interested in trying out an altered configuration file with the closed-source backend.

## 3. Create the Application

Using the provided bitstream and hardware definition files in the respective `hw` folders, a boot image for the FPGA can be generated using the host code contained in the `host/` folder.
To do so, run the following command,

```
xsct create_boot_image.tcl
```

This will create the file `boot/BOOT.bin`.

## 4. Executing Hardware

Either using the exising or regenerated `boot/BOOT.bin` file, copy over to a FAT32 formatted SD card and use with the FPGA.
Once the SD card is installed on the FPGA and the FPGA is powered on, the bitstream will be flashed onto the device and the eembc application will start running.
It is then a case of connecting the UART cable between the device and EEMBC host computer.
